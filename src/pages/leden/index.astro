---
import type { MembersPageQuery, SiteLocale } from '@lib/types/datocms';

import { datocmsRequest } from '@lib/datocms';
import { t } from '@lib/i18n';
import Layout from '@layouts/Default.astro';

import { Button } from '@components/Button';
import { MemberList } from '@blocks/MemberList';
import { PartnerBanner } from '@blocks/PartnerBanner';
import PageHeader from '@blocks/PageHeader/PageHeader.astro';

import membersPageQuery from './membersPage.query.graphql';

const { locale } = Astro.params as { locale: SiteLocale };

const { page, partners } = await datocmsRequest<MembersPageQuery>({
  query: membersPageQuery,
  variables: { locale },
});

if (!page) {
  return new Response(null, { status: 500 });
}
---

<Layout pageUrls={[]} seoMetaTags={page._seoMetaTags}>
  <PageHeader title={page.header.title} subtitle={page.header.subtitle}>
    <Fragment slot="header">
      <Button
        as="a"
        href="../"
        className="back-button"
        level="tertiary"
        icon="arrow-left"
        iconPosition="left">{t('back_to_home')}</Button
      >
    </Fragment>
  </PageHeader>

  <MemberList />

  {partners.length > 0 && <PartnerBanner {partners} />}
</Layout>
